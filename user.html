<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PPI Road to Show Goes to School - Hasil Peserta</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<script>
document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("selectstart", e => e.preventDefault());
document.addEventListener("keydown", e => {
  if (
    e.key === "F12" ||
    (e.ctrlKey && ["u","U","c","C","x","X","s","S","a","A"].includes(e.key)) ||
    (e.ctrlKey && e.shiftKey && ["I","i","J","j"].includes(e.key))
  ) e.preventDefault();
});
</script>

<style>
:root{
    --primary:#dc3545;
    --bg:#f0f4f8;
    --card:#ffffff;
    --text:#343a40;
    --success:#28a745;
    --danger:#dc3545;
    --muted:#6c757d;
}
body{
    font-family:Poppins,sans-serif;
    margin:0;
    background:var(--bg);
    color:var(--text);
  -webkit-tap-hightlight-color:transparent;
}
.container{
    max-width:800px;
    margin:20px auto;
    padding:25px;
    background:var(--card);
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.header-container{
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-bottom:4px solid var(--primary);
    padding-bottom:15px;
    margin-bottom:25px;
}
h1{
    margin:0;
    font-size:1.4em;
    color:var(--primary);
}
.dropdown{position:relative}
.dropbtn{
    background:var(--primary);
    color:#fff;
    border:none;
    padding:8px 12px;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
}
.dropdown-content{
    display:none;
    position:absolute;
    right:0;
    background:#fff;
    min-width:200px;
    box-shadow:0 8px 20px rgba(0,0,0,.2);
    border-radius:8px;
    overflow:hidden;
}
.dropdown-content button{
    width:100%;
    padding:12px;
    border:none;
    background:none;
    text-align:left;
    cursor:pointer;
    font-weight:600;
}
.dropdown-content button:hover{background:#f1f1f1}
.dropdown.show .dropdown-content{display:block}

.user-section{
    background:#f8f9fa;
    padding:20px;
    border-radius:10px;
}

.total-lulus-info{
    font-size:1.05em;
    margin-bottom:20px;
    border-bottom:1px solid var(--muted);
    padding-bottom:10px;
}
.total-lulus-info strong{
    font-size:1.4em;
    color:var(--success);
}

.result-item{
    margin-top:15px;
    padding:16px;
    border-radius:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-weight:600;
    box-shadow:0 2px 5px rgba(0,0,0,.05);
    border-left:6px solid;
}
.lulus{background:#d4edda;border-color:var(--success)}
.tidak-lulus{background:#f8d7da;border-color:var(--danger)}
.status-text{
    font-size:1.2em;
    font-weight:700;
}
@media(max-width:768px){
    .result-item{flex-direction:column;align-items:flex-start}
    .status-text{margin-top:8px}
}
</style>
</head>

<body>
<div class="container">

<div class="header-container">
    <h1>PPI Road to Show Goes to School</h1>
    <div class="dropdown" id="navDropdown">
        <button class="dropbtn" onclick="toggleDropdown()">â‹®</button>
        <div class="dropdown-content">
            <button onclick="location.href='urut.html'">Peserta Terdaftar</button>
            <button onclick="location.href='index.html'">Halaman Utama</button>
        </div>
    </div>
</div>

<h2>Halaman Pengumuman Hasil</h2>

<div class="user-section">

    <div class="total-lulus-info">
        Total Peserta <strong>LULUS</strong> (berdasarkan data Admin):
        <strong id="lulusCount">0</strong> orang
        <div style="font-size:.85em;color:var(--muted);margin-top:5px">
            *Jumlah ini merupakan total keseluruhan peserta lulus menurut Admin,
            bukan berdasarkan data yang sedang ditayangkan.
        </div>
    </div>

    <h3>Daftar Hasil yang <strong>DITAYANGKAN</strong> Admin</h3>

    <div id="realtimeResults">
        <p style="text-align:center;color:var(--muted)">Memuat data...</p>
    </div>

</div>
</div>

<script>
const FIREBASE_CONFIG = {
    apiKey: "AIzaSyDpPEkKbEt6b_v2OWlBfGuaVQpBg2-RWR4",
    authDomain: "cwu-gen-2.firebaseapp.com",
    databaseURL: "https://cwu-gen-2-default-rtdb.firebaseio.com",
    projectId: "cwu-gen-2",
    storageBucket: "cwu-gen-2.appspot.com",
    messagingSenderId: "40585612014",
    appId: "1:40585612014:web:c88141fee3699aca68181ff"
};
firebase.initializeApp(FIREBASE_CONFIG);
const db = firebase.database();

let allPeserta={}, allSekolah={}, allPenilaian={};

db.ref('peserta').on('value', s=>{allPeserta=s.val()||{};render()});
db.ref('sekolah').on('value', s=>{allSekolah=s.val()||{};render()});
db.ref('penilaian').on('value', s=>{allPenilaian=s.val()||{};render()});

function render(){
    const box=document.getElementById('realtimeResults');
    const count=document.getElementById('lulusCount');
    box.innerHTML='';

    /* TOTAL LULUS (DISCLAIMER ADMIN) */
    count.textContent = Object.values(allPenilaian)
        .filter(p => p.hasilLulus && allPeserta[p.idPeserta])
        .length;

    /* DATA DITAYANGKAN â†’ REVERSE URUTAN ADMIN */
    const data = Object.values(allPenilaian)
        .filter(p => p.statusTayang && allPeserta[p.idPeserta])
        .reverse(); // ðŸ”¥ INI YANG MEMBALIK URUTAN

    if(!data.length){
        box.innerHTML='<p style="text-align:center;color:var(--muted)">Belum ada hasil yang ditayangkan.</p>';
        return;
    }

    data.forEach(d=>{
        const p = allPeserta[d.idPeserta];
        const sekolah = allSekolah[p.idSekolah]?.namaSekolah || 'N/A';

        const div = document.createElement('div');
        div.className = 'result-item ' + (d.hasilLulus ? 'lulus' : 'tidak-lulus');
        div.innerHTML = `
            <div>
                <strong>[${p.kodePeserta}] ${p.nama}</strong>
                <div style="font-size:.9em;color:var(--muted)">
                    ${sekolah} (${p.jenisKelamin})
                </div>
                ${d.keterangan ? `<div style="font-size:.85em">Ket: ${d.keterangan}</div>` : ''}
            </div>
            <span class="status-text">${d.hasilLulus ? 'LULUS' : 'TIDAK LULUS'}</span>
        `;
        box.appendChild(div);
    });
}

function toggleDropdown(){
    document.getElementById('navDropdown').classList.toggle('show');
}
window.onclick=e=>{
    if(!e.target.closest('.dropbtn')){
        document.getElementById('navDropdown').classList.remove('show');
    }
};
</script>

</body>
</html>
