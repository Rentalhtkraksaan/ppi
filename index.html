<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PPI Road to Show Goes to School - premium selection</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // Kode Anti-Debugging
        document.addEventListener("contextmenu", e => e.preventDefault());
        document.addEventListener("selectstart", e => e.preventDefault());
        document.addEventListener("keydown", e => {
            if (e.key === "F12" || (e.ctrlKey && ["u","U","c","C","x","X","s","S","a","A"].includes(e.key)) || (e.ctrlKey && e.shiftKey && ["I","i","J","j"].includes(e.key))) e.preventDefault();
        });
    </script>
    <style>
        :root {
            --bg-gradient: radial-gradient(circle at center, #222 0%, #000 100%);
            --card-bg: #111111;
            --gold: #d4af37;
            --blue: #00d2ff;
            --red: #ff416c;
            --yellow: #f1c40f;
            --text: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Poppins', sans-serif;
            margin: 0; background: #000; color: var(--text);
            display: flex; align-items: center; justify-content: center;
            min-height: 100vh; width: 100vw; padding: 20px;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .bg-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-gradient); z-index: -1; }

        .container { 
            width: 100%; max-width: 400px;
            padding: 45px 25px; background: var(--card-bg);
            border-radius: 35px; border: 1px solid rgba(212, 175, 55, 0.2);
            text-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.7);
            position: relative; overflow: hidden;
            margin: auto;
        }

        .state-section { display: none; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .version-tag {
            position: absolute; top: 0; right: 0; background: rgba(212, 175, 55, 0.2);
            color: var(--gold); padding: 5px 15px; font-size: 0.6em;
            font-weight: 700; border-bottom-left-radius: 20px; letter-spacing: 1px;
        }

        h1 { font-size: 1.3em; letter-spacing: 5px; color: var(--gold); margin-bottom: 35px; text-transform: uppercase; }

        .mode-button {
            display: block; width: 100%; padding: 16px; border-radius: 15px;
            font-weight: 600; font-size: 0.85em; letter-spacing: 1.5px;
            margin-bottom: 15px; cursor: pointer; border: none; transition: all 0.3s ease;
        }

        .btn-user { background: rgba(0, 210, 255, 0.1); border: 1px solid var(--blue); color: var(--blue); }
        .btn-admin { background: rgba(255, 65, 108, 0.1); border: 1px solid var(--red); color: var(--red); }
        .btn-panitia { background: rgba(241, 196, 15, 0.1); border: 1px solid var(--yellow); color: var(--yellow); }
        
        .form-input {
            width: 100%; padding: 15px; margin-bottom: 12px;
            background: rgba(255,255,255,0.03); border: 1px solid #333;
            border-radius: 12px; color: white; text-align: center; font-family: 'Poppins';
        }

        .spinner { 
            width: 45px; height: 45px; border: 3px solid rgba(212,175,55,0.1); 
            border-top-color: var(--gold); border-radius: 50%; 
            animation: spin 0.8s linear infinite; margin: 20px auto; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #111; padding: 30px; border-radius: 25px; width: 100%; max-width: 320px; border: 1px solid var(--gold); }

        @keyframes devGlow {
            0% { box-shadow: 0 0 5px rgba(212, 175, 55, 0.1); border-color: rgba(212, 175, 55, 0.1); transform: scale(1); }
            50% { box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); border-color: rgba(212, 175, 55, 0.5); transform: scale(1.01); background: rgba(212, 175, 55, 0.05); }
            100% { box-shadow: 0 0 5px rgba(212, 175, 55, 0.1); border-color: rgba(212, 175, 55, 0.1); transform: scale(1); }
        }

        .dev-glow-button {
            animation: devGlow 3s infinite ease-in-out;
            transition: all 0.5s ease !important;
        }
    </style>
</head>
<body>

    <div class="bg-glow"></div>

    <div class="container">
        <div class="version-tag">V 2.0</div>
        <h1 id="main-title">üèÜ PPI SYSTEM</h1>

        <div id="section-loading" class="state-section" style="display: block;">
            <div class="spinner"></div>
            <p style="font-size: 0.7em; letter-spacing: 2px; color: var(--gold); opacity: 0.8;">AUTHENTICATING DEVICE...</p>
        </div>

        <div id="section-blocked" class="state-section">
            <div style="font-size: 4em; margin-bottom: 15px;">üö´</div>
            <h2 style="color: var(--red); letter-spacing: 2px;">ACCESS DENIED</h2>
            <p style="font-size: 0.8em; opacity: 0.6; line-height: 1.6;">Perangkat Anda telah diblokir.</p>
        </div>

        <div id="section-register" class="state-section">
            <p style="font-size: 0.75em; color: var(--gold); margin-bottom: 25px; letter-spacing: 1px;">DAFTARKAN IDENTITAS ANDA</p>
            <form onsubmit="saveIdentity(event)">
                <input type="text" id="reg-nama" class="form-input" placeholder="NAMA LENGKAP" required>
                <input type="number" id="reg-angkatan" class="form-input" placeholder="ANGKATAN" required>
                <select id="reg-status" class="form-input" required style="appearance: none;">
                    <option value="" disabled selected>PILIH STATUS</option>
                    <option value="PENGURUS">PENGURUS</option>
                    <option value="PPI">PPI</option>
                </select>
                <button type="submit" class="mode-button" style="background: var(--gold); color: #000; margin-top: 10px; font-weight: 700;">REQUEST ACCESS</button>
            </form>
        </div>

        <div id="section-closed" class="state-section">
            <div style="padding: 40px 20px; border: 1px dashed var(--red); border-radius: 25px; background: rgba(255, 65, 108, 0.05);">
                <h3 style="color: var(--red); margin: 0; letter-spacing: 2px;">PORTAL CLOSED</h3>
                <p style="font-size: 0.75em; opacity: 0.7; margin-top: 10px;">Akses ditutup.</p>
            </div>
        </div>

        <div id="section-menu" class="state-section">
            <div id="user-info" style="font-size: 0.65em; color: var(--gold); margin-bottom: 25px; opacity: 0.7;"></div>
            <button onclick="handleUserAccess()" class="mode-button btn-user">OPEN RESULT PORTAL</button>
            <button onclick="showLogin('admin')" class="mode-button btn-admin">ADMINISTRATOR</button>
            <button onclick="showLogin('panitia')" class="mode-button btn-panitia">COMMITTEE AREA</button>
        </div>

        <button id="dev-link" onclick="logAction('DEV_VIEW', 'biodata.html')" class="mode-button dev-glow-button" style="display:none; background:none; color:rgba(212,175,55,0.6); font-size:0.65em; border:1px solid rgba(212,175,55,0.1); margin-top:30px; letter-spacing: 1px;">
            VIEW BIODATA DEVELOPER SISTEM
        </button>
    </div>

    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h3 id="login-title" style="color: var(--gold); font-size: 0.9em; margin-bottom: 20px; letter-spacing: 2px;"></h3>
            <form onsubmit="handleLogin(event)">
                <input type="hidden" id="role-input">
                <input type="password" id="password-input" class="form-input" placeholder="ENTER PASSKEY" required>
                <button type="submit" class="mode-button" style="background:var(--gold); color:#000; font-weight: 700;">VERIFY</button>
                <button type="button" onclick="hideLogin()" style="background:none; border:none; color:#555; width:100%; margin-top:10px; cursor:pointer; font-size: 0.8em;">CANCEL</button>
            </form>
        </div>
    </div>

    <script>
        const CONFIG = {
            apiKey: "AIzaSyDpPEkKbEt6b_v2OWlBfGuaVQpBg2-RWR4",
            authDomain: "cwu-gen-2.firebaseapp.com",
            databaseURL: "https://cwu-gen-2-default-rtdb.firebaseio.com",
            projectId: "cwu-gen-2",
            storageBucket: "cwu-gen-2.appspot.com",
            messagingSenderId: "40585612014",
            appId: "1:40585612014:web:c88141fee3699aca68181ff"
        };
        firebase.initializeApp(CONFIG);
        const db = firebase.database();
        const KEYS = { admin: "aditanakcakep", panitia: "ppipanitia" };

        function setView(id) {
            document.querySelectorAll('.state-section').forEach(s => s.style.display = 'none');
            const target = document.getElementById(id);
            if(target) target.style.display = 'block';
        }

        async function initApp() {
            const localNama = localStorage.getItem('ppi_nama');
            if (!localNama) { setView('section-register'); return; }
            const fingerprint = localNama + "_" + navigator.userAgent.slice(-15);
            db.ref('developer_clicks').orderByChild('user_id').equalTo(fingerprint).once('value', (snap) => {
                if (!snap.exists()) {
                    localStorage.clear();
                    alert("Sesi berakhir. Silahkan isi ulang.");
                    location.reload();
                    return;
                }
                document.getElementById('user-info').textContent = "WELCOME, " + localNama.toUpperCase() + '!';
                startSync(fingerprint);
            });
        }

        function startSync(fingerprint) {
            db.ref().on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) return;
                const blacklist = Object.values(data.blacklist || {});
                const isPortalOpen = (data.kepo_toggle === 'on');

                if (blacklist.includes(fingerprint)) {
                    setView('section-blocked');
                    document.getElementById('main-title').style.display = 'none';
                    document.getElementById('dev-link').style.display = 'none';
                } else {
                    setView(isPortalOpen ? 'section-menu' : 'section-closed');
                    document.getElementById('dev-link').style.display = 'block';
                }
            });
        }

        async function saveIdentity(e) {
            e.preventDefault();
            localStorage.setItem('ppi_nama', document.getElementById('reg-nama').value.trim());
            localStorage.setItem('ppi_angkatan', document.getElementById('reg-angkatan').value);
            localStorage.setItem('ppi_status', document.getElementById('reg-status').value);
            await logAction('NEW_REGISTRATION', null);
            location.reload();
        }

        async function logAction(label, url) {
            const n = localStorage.getItem('ppi_nama') || 'Guest';
            const fingerprint = n + "_" + navigator.userAgent.slice(-15);
            const now = new Date();
            
            // PERBAIKAN: Menambahkan logika Hari
            const daftarHari = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
            const hariIni = daftarHari[now.getDay()];

            try {
                await db.ref('developer_clicks').push({
                    user_id: fingerprint,
                    nama: n,
                    info_tambahan: (localStorage.getItem('ppi_status') || '-') + " (" + (localStorage.getItem('ppi_angkatan') || '-') + ")",
                    perangkat: navigator.userAgent,
                    tanggal: now.toLocaleDateString('id-ID'),
                    hari: hariIni, // Data hari dikirim ke database
                    jam: now.toLocaleTimeString('id-ID', {hour12:false}),
                    tipe_akses: label
                });
            } catch(e) {}
            if (url) window.location.href = url;
        }

        function showLogin(role) {
            document.getElementById('login-modal').style.display = 'flex';
            document.getElementById('role-input').value = role;
            document.getElementById('login-title').textContent = role.toUpperCase() + ' ACCESS';
        }

        function hideLogin() { 
            document.getElementById('login-modal').style.display = 'none'; 
            document.getElementById('password-input').value = '';
        }

        async function handleLogin(e) {
            e.preventDefault();
            const role = document.getElementById('role-input').value;
            if (document.getElementById('password-input').value === KEYS[role]) {
                await logAction(role.toUpperCase() + '_LOGIN', role + '.html');
            } else {
                alert("PASSKEY SALAH!");
            }
        }

        async function handleUserAccess() { await logAction('USER_PORTAL_OPEN', 'user.html'); }
        window.onload = initApp;
    </script>
</body>
</html>
